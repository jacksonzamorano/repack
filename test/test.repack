snippet base {
	id uuid db:pk
	created_date datetime db:default("NOW()")
}

enum UserType #model {
	Admin
	User
	Guest
}

struct User @users #model {
	snippet:base

	last_login datetime?
	name string
	email string
	user_type UserType
	subscription_id string?


	query UserByEmail(_email string) = "SELECT $fields FROM $table WHERE $email = $_email" -> item
	query UsersByType(_typ UserType) = "SELECT $fields FROM $table WHERE $user_type = $_typ" -> list
	query DeleteUserById(_id uuid) = "DELETE FROM $table WHERE $id = $_id"

	insert SaveUser except (last_login, subscription_id)
	update UpdateUserLogin (last_login)
}

struct Token @tokens #model {
	!base
	user_id uuid ref(User.id)
	token_value uuid

	insert (user_id, token_value)
}
