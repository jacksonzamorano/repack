BEGIN;


DROP TABLE IF EXISTS Organization;

DROP TABLE IF EXISTS Product;

DROP TABLE IF EXISTS TempIdList;

DROP TABLE IF EXISTS User;

DROP TABLE IF EXISTS List;

DROP TABLE IF EXISTS AllUserList;

DROP TABLE IF EXISTS Todo;


CREATE TABLE Organization (

	id INT4 NOT NULL,
	created_date TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	name TEXT NOT NULL,
	email TEXT NOT NULL
);

CREATE TABLE Product (

	id INT4 NOT NULL,
	created_date TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	monthly_price INT4 NOT NULL,
	yearly_price INT4 NOT NULL
);

CREATE TABLE TempIdList (

	id INT4 NOT NULL
);

CREATE TABLE User (

	id INT4 NOT NULL,
	created_date TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	org_id INT4 NOT NULL FOREIGN KEY REFERENCES Organization(id),
	name TEXT NOT NULL,
	email TEXT NOT NULL,
	password TEXT NOT NULL,
	login_count INT8 NOT NULL DEFAULT 0,
	last_login TIMESTAMPTZ,
	total_cost FLOAT8 NOT NULL DEFAULT 0,
	permission UserPermission NOT NULL
);

CREATE TABLE List (

	id INT4 NOT NULL,
	created_date TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	org_id INT4 NOT NULL FOREIGN KEY REFERENCES Organization(id),
	title TEXT NOT NULL,
	description TEXT NOT NULL,
	creator_user_id INT4 NOT NULL FOREIGN KEY REFERENCES User(id)
);

CREATE TABLE AllUserList (

	id INT4 NOT NULL,
	created_date TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	name TEXT NOT NULL,
	email TEXT NOT NULL,
	login_count INT8 NOT NULL DEFAULT 0,
	last_login TIMESTAMPTZ,
	total_cost FLOAT8 NOT NULL DEFAULT 0,
	permission UserPermission NOT NULL,
	org_id INT4 NOT NULL FOREIGN KEY REFERENCES Organization(id),
	org_name TEXT NOT NULL
);

CREATE TABLE Todo (

	id INT4 NOT NULL,
	created_date TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	org_id INT4 NOT NULL FOREIGN KEY REFERENCES Organization(id),
	done BOOL NOT NULL,
	title TEXT NOT NULL,
	description TEXT NOT NULL,
	creator_user_id INT4 NOT NULL FOREIGN KEY REFERENCES User(id),
	assigned_user_id INT4 FOREIGN KEY REFERENCES User(id),
	list_id INT4 FOREIGN KEY REFERENCES List(id)
);

